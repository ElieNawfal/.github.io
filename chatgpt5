import { html, css, LitElement } from 'lit';
import { API } from '@openai/api';

class ChatGptPlugin extends LitElement {
  static styles = css`
    /* Add your component styles here */
  `;

  render() {
    return html`
      <div>
        <input id="queryInput" type="text" placeholder="Ask a question" />
        <button @click="${this.handleChat}">Ask</button>
        <div id="responseArea"></div>
      </div>
    `;
  }

  async handleChat() {
    const queryInput = this.shadowRoot.getElementById('queryInput');
    const responseArea = this.shadowRoot.getElementById('responseArea');

    const query = queryInput.value.trim();
    if (query === '') return;

    const openai = new API({ apiKey: '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' });

    try {
      responseArea.textContent = 'Thinking...';

      const response = await openai.chatCompletion.create({
        model: 'gpt-3.5-turbo',
        messages: [
          { role: 'system', content: 'You are a helpful assistant.' },
          { role: 'user', content: query }
        ]
      });

      const answer = response.choices[0].message.content;
      responseArea.textContent = answer;
    } catch (error) {
      console.error('Chat GPT request failed:', error);
      responseArea.textContent = 'Sorry, an error occurred.';
    } finally {
      queryInput.value = '';
    }
  }
}

customElements.define('chat-gpt-plugin', ChatGptPlugin);
